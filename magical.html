<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆë²•ì†Œë…€ í”„ë¡œí•„ (ìˆ˜ì • ê°€ëŠ¥)</title>
    <style>
        @font-face {
    font-family: 'RoundedFixedsys';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
    font-weight: normal;
    font-display: swap;
}
        /* --- ê¸°ì¡´ CSS ì½”ë“œëŠ” ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', 'Orbitron', monospace; background: #0a0a0a; color: #e0e0e0; line-height: 1.4; padding: 20px; background-image: radial-gradient(circle at 25% 25%, #111 1px, transparent 1px), radial-gradient(circle at 75% 75%, #111 1px, transparent 1px); background-size: 20px 20px; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: #1a1a1a; border: 3px solid #333; box-shadow: 0 0 0 1px #666, inset 0 0 0 1px #000, 0 0 20px rgba(255,255,255,0.1); position: relative; }
        .container::before { content: ''; position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px; background: linear-gradient(45deg, #444, #222, #444, #222); z-index: -1; }
        .header { background: #000; border-bottom: 2px solid #333; padding: 15px 20px; text-align: center; position: relative; }
        .header::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #666, transparent); }
        .title { font-size: 24px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; color: #fff; text-shadow: 2px 2px 0 #000, -1px -1px 0 #333; }
        .subtitle { font-size: 12px; color: #888; margin-top: 5px; letter-spacing: 2px; }
        .content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
        .profile-section { grid-column: 1 / -1; display: grid; grid-template-columns: 200px 1fr; gap: 20px; margin-bottom: 10px; }
        .profile-image { width: 200px; height: 200px; border: 3px solid #333; background: #111; display: flex; align-items: center; justify-content: center; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); cursor: pointer; overflow: hidden; }
        .profile-image::before { content: 'ğŸ“·'; font-size: 48px; opacity: 0.3; position: absolute; }
        .profile-image img { width: 100%; height: 100%; object-fit: cover; filter: contrast(1.2) grayscale(0.8); position: relative; z-index: 1; }
        .basic-info { background: #111; border: 2px solid #333; padding: 15px; }
        .info-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 14px; }
        .info-label { width: 80px; color: #aaa; font-weight: bold; flex-shrink: 0; }
        .info-value { color: #fff; flex: 1; }
        .section { background: #111; border: 2px solid #333; margin-bottom: 20px; }
        .section-header { background: #222; border-bottom: 1px solid #333; padding: 10px 15px; font-size: 14px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; color: #ccc; }
        .section-content { padding: 15px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-item { margin-bottom: 10px; }
        .stat-label { font-size: 12px; color: #aaa; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; display: flex; justify-content: space-between; align-items: center; }
        .stat-bar { background: #000; border: 1px solid #333; height: 20px; position: relative; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); }
        .stat-fill { background: linear-gradient(90deg, #333, #666, #333); height: 100%; position: relative; transition: width 0.3s ease; }
        .stat-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); }
        .stat-value { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 10px; font-weight: bold; color: #fff; text-shadow: 1px 1px 0 #000; }
        .description { font-size: 13px; line-height: 1.6; color: #ccc; }
        .magic-theme { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; min-height: 25px;}
        .theme-tag { background: #222; border: 1px solid #444; padding: 4px 8px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #aaa; }
        .editable { background: transparent; border: 1px dashed #555; color: #ccc; padding: 2px 4px; font-family: inherit; font-size: inherit; width: 100%; }
        .editable:focus { outline: none; border-color: #777; background: #222; }
        textarea.editable { width: 100%; min-height: 80px; resize: vertical; }
        .stat-input { width: 60px !important; text-align: center; background: #000; border: 1px solid #333; }
        .button-container { grid-column: 1 / -1; display: flex; gap: 10px; justify-content: flex-end; }
        .button { background: #222; border: 1px solid #444; color: #ccc; padding: 8px 15px; cursor: pointer; text-transform: uppercase; font-family: 'Orbitron', monospace; letter-spacing: 1px; font-size: 12px; transition: all 0.2s; }
        .button:hover { background: #333; color: #fff; border-color: #666; }
        .glitch { position: relative; animation: glitch 3s infinite; }
        @keyframes glitch { 0%, 100% { transform: translate(0); } 20% { transform: translate(-1px, 1px); } 40% { transform: translate(-1px, -1px); } 60% { transform: translate(1px, 1px); } 80% { transform: translate(1px, -1px); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title glitch">MAGICAL GIRL</div>
            <div class="subtitle">PROFILE DATABASE</div>
        </div>

        <div class="content">
            <div class="profile-section">
                <div class="profile-image" id="profile-image-container">
                    <img id="profile-img" src="" alt="">
                </div>
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                
                <div class="basic-info">
                    <div class="section-header">ê¸°ë³¸ ì •ë³´</div>
                    <div class="section-content">
                        <div class="info-row">
                            <span class="info-label">ì´ë¦„:</span>
                            <input type="text" id="char-name" class="editable info-value" placeholder="ë§ˆë²•ì†Œë…€ ì´ë¦„">
                        </div>
                        <div class="info-row">
                            <span class="info-label">ë‚˜ì´:</span>
                            <input type="text" id="char-age" class="editable info-value" placeholder="16">
                        </div>
                        <div class="info-row">
                            <span class="info-label">ë“±ê¸‰:</span>
                            <input type="text" id="char-rank" class="editable info-value" placeholder="Sê¸‰">
                        </div>
                        <div class="info-row">
                            <span class="info-label">ì†Œì†:</span>
                            <input type="text" id="char-faction" class="editable info-value" placeholder="ë§ˆë²•ì†Œë…€ ì—°í•©">
                        </div>
                        <div class="info-row">
                            <span class="info-label">ê³„ì•½ì¼:</span>
                            <input type="text" id="char-contract-date" class="editable info-value" placeholder="2024.03.15">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">ëŠ¥ë ¥ì¹˜</div>
                <div class="section-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label"><span>ë§ˆë²•ì†Œë…€ ì ì„±</span><input type="number" id="stat-aptitude" class="editable stat-input" value="85" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-aptitude-fill" class="stat-fill"></div><div id="stat-aptitude-value" class="stat-value"></div></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span>ê³µê²©ë ¥</span><input type="number" id="stat-attack" class="editable stat-input" value="70" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-attack-fill" class="stat-fill"></div><div id="stat-attack-value" class="stat-value"></div></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span>ë°©ì–´ë ¥</span><input type="number" id="stat-defense" class="editable stat-input" value="60" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-defense-fill" class="stat-fill"></div><div id="stat-defense-value" class="stat-value"></div></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span>ë§ˆë‚˜ íš¨ìœ¨</span><input type="number" id="stat-mana" class="editable stat-input" value="90" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-mana-fill" class="stat-fill"></div><div id="stat-mana-value" class="stat-value"></div></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span>ë¯¼ì²©ì„±</span><input type="number" id="stat-agility" class="editable stat-input" value="75" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-agility-fill" class="stat-fill"></div><div id="stat-agility-value" class="stat-value"></div></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span>ì •ì‹ ë ¥</span><input type="number" id="stat-spirit" class="editable stat-input" value="95" min="0" max="100"></div>
                            <div class="stat-bar"><div id="stat-spirit-fill" class="stat-fill"></div><div id="stat-spirit-value" class="stat-value"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">ë§ˆë²• & í…Œë§ˆ</div>
                <div class="section-content">
                    <div class="info-row">
                        <span class="info-label">ì£¼ ì†ì„±:</span>
                        <input type="text" id="magic-attribute" class="editable info-value" placeholder="ë¹›/ì¹˜ìœ ">
                    </div>
                    <div class="info-row">
                        <span class="info-label">ë¬´ê¸°:</span>
                        <input type="text" id="magic-weapon" class="editable info-value" placeholder="í¬ë¦¬ìŠ¤í„¸ ìŠ¤íƒœí”„">
                    </div>
                    <div class="info-row">
                        <span class="info-label">í…Œë§ˆ íƒœê·¸:</span>
                        <input type="text" id="theme-tags-input" class="editable info-value" placeholder="ì‰¼í‘œ(,)ë¡œ íƒœê·¸ êµ¬ë¶„" value="HEALING, LIGHT MAGIC, BARRIER, PURIFICATION">
                    </div>
                    <div id="theme-tags-output" class="magic-theme">
                        </div>
                </div>
            </div>
            
            <div class="section" style="grid-column: 1 / -1;">
                <div class="section-header">í•´ì„ & ì„¤ëª…</div>
                <div class="section-content">
                    <textarea id="char-description" class="editable description" placeholder="ë§ˆë²•ì†Œë…€ì˜ ëŠ¥ë ¥, ì„±ê²©, ì „íˆ¬ ìŠ¤íƒ€ì¼ì— ëŒ€í•œ ìƒì„¸í•œ ë¶„ì„ê³¼ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                </div>
            </div>

            <div class="button-container">
                <button id="save-button" class="button">ì €ì¥</button>
                <button id="reset-button" class="button">ì´ˆê¸°í™”</button>
                <button id="download-button" class="button">ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
            </div>
        </div>
    </div>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const stats = ['aptitude', 'attack', 'defense', 'mana', 'agility', 'spirit'];

            // 1. ëŠ¥ë ¥ì¹˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateStat(statName) {
                const input = document.getElementById(`stat-${statName}`);
                const fill = document.getElementById(`stat-${statName}-fill`);
                const valueText = document.getElementById(`stat-${statName}-value`);
                let value = parseInt(input.value, 10);
                if (isNaN(value) || value < 0) value = 0;
                if (value > 100) value = 100;
                
                fill.style.width = value + '%';
                valueText.textContent = `${value}/100`;
            }

            // 2. í…Œë§ˆ íƒœê·¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateThemeTags() {
                const input = document.getElementById('theme-tags-input');
                const output = document.getElementById('theme-tags-output');
                output.innerHTML = '';
                const tags = input.value.split(',')
                    .map(tag => tag.trim())
                    .filter(tag => tag.length > 0);
                
                tags.forEach(tagText => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'theme-tag';
                    tagElement.textContent = tagText;
                    output.appendChild(tagElement);
                });
            }

            // 3. í”„ë¡œí•„ ì´ë¯¸ì§€ ë¡œë“œ
            const imageContainer = document.getElementById('profile-image-container');
            const imageUpload = document.getElementById('image-upload');
            const profileImg = document.getElementById('profile-img');

            imageContainer.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', event => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        profileImg.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // 4. ë°ì´í„° ì €ì¥ í•¨ìˆ˜
            function saveData() {
                const data = {
                    name: document.getElementById('char-name').value,
                    age: document.getElementById('char-age').value,
                    rank: document.getElementById('char-rank').value,
                    faction: document.getElementById('char-faction').value,
                    contractDate: document.getElementById('char-contract-date').value,
                    description: document.getElementById('char-description').value,
                    attribute: document.getElementById('magic-attribute').value,
                    weapon: document.getElementById('magic-weapon').value,
                    tags: document.getElementById('theme-tags-input').value,
                    stats: {},
                    profileImage: profileImg.src,
                };
                stats.forEach(stat => {
                    data.stats[stat] = document.getElementById(`stat-${stat}`).value;
                });

                localStorage.setItem('magicalGirlProfile', JSON.stringify(data));
                alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }

            // 5. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
            function loadData() {
                const dataString = localStorage.getItem('magicalGirlProfile');
                if (dataString) {
                    const data = JSON.parse(dataString);
                    document.getElementById('char-name').value = data.name || '';
                    document.getElementById('char-age').value = data.age || '';
                    document.getElementById('char-rank').value = data.rank || '';
                    document.getElementById('char-faction').value = data.faction || '';
                    document.getElementById('char-contract-date').value = data.contractDate || '';
                    document.getElementById('char-description').value = data.description || '';
                    document.getElementById('magic-attribute').value = data.attribute || '';
                    document.getElementById('magic-weapon').value = data.weapon || '';
                    document.getElementById('theme-tags-input').value = data.tags || '';
                    if (data.profileImage) {
                        profileImg.src = data.profileImage;
                    }
                    
                    stats.forEach(stat => {
                        document.getElementById(`stat-${stat}`).value = data.stats[stat] || 0;
                    });
                }
                // ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¡œ UI ì—…ë°ì´íŠ¸
                stats.forEach(updateStat);
                updateThemeTags();
            }

            // 6. ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
            function resetData() {
                if(confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ëœ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                    localStorage.removeItem('magicalGirlProfile');
                    location.reload();
                }
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            stats.forEach(stat => {
                document.getElementById(`stat-${stat}`).addEventListener('input', () => updateStat(stat));
            });
            document.getElementById('theme-tags-input').addEventListener('input', updateThemeTags);
            document.getElementById('save-button').addEventListener('click', saveData);
            document.getElementById('reset-button').addEventListener('click', resetData);

            // --- ì¶”ê°€ëœ ì½”ë“œ: ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ ---
            document.getElementById('download-button').addEventListener('click', function() {
                const profileContainer = document.querySelector('.container');
                const charName = document.getElementById('char-name').value || 'magical-girl';
                const button = this;
                
                button.textContent = 'ìƒì„± ì¤‘...';
                button.disabled = true;

                html2canvas(profileContainer, { 
                    backgroundColor: '#0a0a0a', // ë°°ê²½ìƒ‰ ì§€ì •
                    useCORS: true // í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì™¸ë¶€ URLì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${charName}-profile.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();

                    button.textContent = 'ì´ë¯¸ì§€ë¡œ ì €ì¥';
                    button.disabled = false;
                }).catch(err => {
                    console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜!', err);
                    alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    button.textContent = 'ì´ë¯¸ì§€ë¡œ ì €ì¥';
                    button.disabled = false;
                });
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            loadData();
        });
    </script>
</body>
</html>
